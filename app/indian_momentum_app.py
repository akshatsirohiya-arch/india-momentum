# indian_momentum_app.py
# EXACT CLONE OF US APP — ONLY TICKERS CHANGED
# TA-only (Slope + 1M + 3M returns), NO FUNDAMENTALS

import streamlit as st
import pandas as pd
import numpy as np
import yfinance as yf

st.set_page_config(layout="wide", page_title="Momentum Scanner India (No Fundamentals)")

# ----------------------------------
# LOAD TICKERS (INDIA / NSE)
# ----------------------------------
TICKERS = [
    "500002.NS",
"500003.NS",
"500008.NS",
"500020.NS",
"500027.NS",
"500031.NS",
"500032.NS",
"500033.NS",
"500034.NS",
"500038.NS",
"500039.NS",
"ABREL.NS",
"500041.NS",
"500042.NS",
"500043.NS",
"500048.NS",
"500049.NS",
"500052.NS",
"500067.NS",
"500068.NS",
"500078.NS",
"500084.NS",
"500085.NS",
"500086.NS",
"CIPLA.NS",
"CRISIL.NS",
"CGPOWER.NS",
"DABUR.NS",
"DALMIASUG.NS",
"ARVIND.NS",
"BHEL.NS",
"HINDPETRO.NS",
"IFCI.NS",
"MTNL.NS",
"MRPL.NS",
"CHENNPETRO.NS",
"SBIN.NS",
"SAIL.NS",
"TITAN.NS",
"IDBI.NS",
"500117.NS",
"500123.NS",
"500124.NS",
"EIDPARRY.NS",
"500126.NS",
"500128.NS",
"500133.NS",
"500135.NS",
"500136.NS",
"500144.NS",
"500147.NS",
"500148.NS",
"500150.NS",
"500163.NS",
"500164.NS",
"500165.NS",
"500168.NS",
"500171.NS",
"500180.NS",
"500182.NS",
"500183.NS",
"500184.NS",
"500187.NS",
"500188.NS",
"500191.NS",
"500199.NS",
"500201.NS",
"500207.NS",
"500209.NS",
"500210.NS",
"500214.NS",
"500215.NS",
"500219.NS",
"500227.NS",
"500228.NS",
"500233.NS",
"500235.NS",
"500238.NS",
"500241.NS",
"500243.NS",
"500245.NS",
"500249.NS",
"LGBBROSLTD.NS",
"TRENT.NS",
"500252.NS",
"100253.NS",
"500257.NS",
"500260.NS",
"500265.NS",
"500266.NS",
"500268.NS",
"500271.NS",
"500280.NS",
"500285.NS",
"500288.NS",
"500292.NS",
"NCC.NS",
"100295.NS",
"890190.NS",
"500302.NS",
"500304.NS",
"500306.NS",
"500307.NS",
"500314.NS",
"500317.NS",
"890147.NS",
"500330.NS",
"500331.NS",
"500333.NS",
"500335.NS",
"500336.NS",
"500338.NS",
"500339.NS",
"500355.NS",
"500365.NS",
"500368.NS",
"500378.NS",
"500380.NS",
"500387.NS",
"500390.NS",
"500400.NS",
"500402.NS",
"500403.NS",
"SUNFLAG.NS",
"500405.NS",
"500407.NS",
"500408.NS",
"500410.NS",
"500411.NS",
"500412.NS",
"500413.NS",
"500414.NS",
"500420.NS",
"100425.NS",
"500429.NS",
"500439.NS",
"100440.NS",
"500444.NS",
"500126.NS",
"500460.NS",
"500463.NS",
"500469.NS",
"500470.NS",
"500472.NS",
"100477.NS",
"500480.NS",
"100483.NS",
"500488.NS",
"500490.NS",
"500493.NS",
"500495.NS",
"500510.NS",
"M&M.NS",
"500530.NS",
"100547.NS",
"500550.NS",
"500570.NS",
"500575.NS",
"500620.NS",
"DEEPAKFERT.NS",
"500650.NS",
"500655.NS",
"500660.NS",
"500670.NS",
"500672.NS",
"500674.NS",
"500680.NS",
"500690.NS",
"500696.NS",
"500710.NS",
"500730.NS",
"500770.NS",
"500790.NS",
"500800.NS",
"500820.NS",
"500825.NS",
"500830.NS",
"500840.NS",
"100850.NS",
"500870.NS",
"500875.NS",
"500877.NS",
"500878.NS",
"500940.NS",
"501150.NS",
"501301.NS",
"501421.NS",
"501423.NS",
"501425.NS",
"501455.NS",
"502090.NS",
"502137.NS",
"502157.NS",
"502168.NS",
"SHREDIGCEM.NS",
"502219.NS",
"502330.NS",
"502355.NS",
"502450.NS",
"502986.NS",
"503100.NS",
"503101.NS",
"503310.NS",
"503681.NS",
"503806.NS",
"503811.NS",
"503960.NS",
"504000.NS",
"504036.NS",
"504067.NS",
"504112.NS",
"504212.NS",
"504341.NS",
"504614.NS",
"532814.NS",
"504882.NS",
"504918.NS",
"504973.NS",
"505010.NS",
"505160.NS",
"505192.NS",
"505196.NS",
"505200.NS",
"505242.NS",
"505255.NS",
"500243.NS",
"505355.NS",
"505400.NS",
"505412.NS",
"505504.NS",
"505509.NS",
"505526.NS",
"505533.NS",
"505537.NS",
"505700.NS",
"505710.NS",
"505714.NS",
"505725.NS",
"505726.NS",
"505744.NS",
"505790.NS",
"505800.NS",
"505872.NS",
"505890.NS",
"506022.NS",
"506076.NS",
"506109.NS",
"2723.NS",
"506194.NS",
"506197.NS",
"506222.NS",
"506235.NS",
"506260.NS",
"506285.NS",
"506390.NS",
"506395.NS",
"506401.NS",
"506480.NS",
"506590.NS",
"506618.NS",
"506655.NS",
"506685.NS",
"506690.NS",
"506767.NS",
"506820.NS",
"506854.NS",
"506879.NS",
"JBCHEPHARM.NS",
"507205.NS",
"507410.NS",
"507488.NS",
"530305.NS",
"507514.NS",
"507526.NS",
"507685.NS",
"507717.NS",
"507747.NS",
"507753.NS",
"507789.NS",
"507815.NS",
"507878.NS",
"507880.NS",
"507944.NS",
"508486.NS",
"508807.NS",
"508814.NS",
"508869.NS",
"508933.NS",
"508954.NS",
"NAVNETEDUL.NS",
"509079.NS",
"509152.NS",
"509243.NS",
"509438.NS",
"509480.NS",
"509488.NS",
"509496.NS",
"509557.NS",
"509631.NS",
"509675.NS",
"532814.NS",
"509820.NS",
"509930.NS",
"509966.NS",
"531543.NS",
"511076.NS",
"511196.NS",
"511218.NS",
"511243.NS",
"511413.NS",
"511431.NS",
"511551.NS",
"511676.NS",
"511742.NS",
"511768.NS",
"512008.NS",
"512020.NS",
"512068.NS",
"UPL.NS",
"535136.NS",
"512179.NS",
"512237.NS",
"512267.NS",
"512329.NS",
"512455.NS",
"512463.NS",
"512529.NS",
"512573.NS",
"512599.NS",
"513023.NS",
"513097.NS",
"513228.NS",
"513250.NS",
"513262.NS",
"513269.NS",
"513349.NS",
"513375.NS",
"513377.NS",
"513517.NS",
"513519.NS",
"513536.NS",
"513599.NS",
"513683.NS",
"514043.NS",
"514162.NS",
"514167.NS",
"514234.NS",
"514446.NS",
"514448.NS",
"515030.NS",
"515055.NS",
"516072.NS",
"517015.NS",
"517035.NS",
"517041.NS",
"517059.NS",
"517146.NS",
"517168.NS",
"517174.NS",
"517206.NS",
"517271.NS",
"517334.NS",
"517354.NS",
"517380.NS",
"517385.NS",
"517421.NS",
"517467.NS",
"517498.NS",
"517500.NS",
"517506.NS",
"517522.NS",
"517544.NS",
"517569.NS",
"519091.NS",
"519126.NS",
"519156.NS",
"519183.NS",
"519477.NS",
"519552.NS",
"519600.NS",
"519602.NS",
"520051.NS",
"717505.NS",
"520057.NS",
"520073.NS",
"520111.NS",
"520113.NS",
"521016.NS",
"521064.NS",
"521070.NS",
"521238.NS",
"521248.NS",
"522029.NS",
"522034.NS",
"522064.NS",
"522073.NS",
"522074.NS",
"522101.NS",
"522108.NS",
"522113.NS",
"522163.NS",
"522195.NS",
"522205.NS",
"522215.NS",
"522249.NS",
"522257.NS",
"522261.NS",
"522275.NS",
"522281.NS",
"522285.NS",
"522287.NS",
"522295.NS",
"523025.NS",
"523105.NS",
"523127.NS",
"523207.NS",
"523261.NS",
"523301.NS",
"523319.NS",
"523369.NS",
"523385.NS",
"523395.NS",
"523398.NS",
"523405.NS",
"523445.NS",
"523457.NS",
"523475.NS",
"523539.NS",
"523598.NS",
"523606.NS",
"523610.NS",
"523618.NS",
"523630.NS",
"523642.NS",
"523694.NS",
"523704.NS",
"523708.NS",
"523716.NS",
"523736.NS",
"523838.NS",
"524000.NS",
"KINGFA.NS",
"524091.NS",
"524164.NS",
"524200.NS",
"524208.NS",
"524226.NS",
"524332.NS",
"524348.NS",
"524372.NS",
"524394.NS",
"524404.NS",
"524470.NS",
"524494.NS",
"524520.NS",
"524558.NS",
"524648.NS",
"524667.NS",
"524669.NS",
"524709.NS",
"524715.NS",
"524735.NS",
"524742.NS",
"524743.NS",
"524804.NS",
"524816.NS",
"524820.NS",
"526125.NS",
"526227.NS",
"526247.NS",
"526299.NS",
"126371.NS",
"526433.NS",
"526506.NS",
"526521.NS",
"526608.NS",
"526612.NS",
"526650.NS",
"526729.NS",
"526797.NS",
"526807.NS",
"526829.NS",
"526881.NS",
"526951.NS",
"527001.NS",
"530005.NS",
"530007.NS",
"530019.NS",
"530073.NS",
"530075.NS",
"530079.NS",
"530117.NS",
"530131.NS",
"530135.NS",
"530199.NS",
"530239.NS",
"530305.NS",
"530307.NS",
"530343.NS",
"530355.NS",
"530367.NS",
"530475.NS",
"530517.NS",
"530549.NS",
"530555.NS",
"530643.NS",
"530655.NS",
"530699.NS",
"530759.NS",
"530813.NS",
"530843.NS",
"543489.NS",
"530879.NS",
"530927.NS",
"530943.NS",
"530965.NS",
"530999.NS",
"531092.NS",
"531112.NS",
"531120.NS",
"531147.NS",
"531162.NS",
"531179.NS",
"531201.NS",
"531209.NS",
"531213.NS",
"531335.NS",
"531344.NS",
"531349.NS",
"531357.NS",
"531358.NS",
"531381.NS",
"531431.NS",
"531449.NS",
"531500.NS",
"531508.NS",
"531531.NS",
"531543.NS",
"531548.NS",
"531595.NS",
"FDC.NS",
"531633.NS",
"531637.NS",
"531642.NS",
"531717.NS",
"531719.NS",
"531761.NS",
"531768.NS",
"531795.NS",
"GOPAL.NS",
"531921.NS",
"532029.NS",
"532054.NS",
"532067.NS",
"132134.NS",
"532144.NS",
"532149.NS",
"532514.NS",
"532155.NS",
"532156.NS",
"532162.NS",
"532163.NS",
"532174.NS",
"532175.NS",
"532178.NS",
"532180.NS",
"532181.NS",
"532187.NS",
"532210.NS",
"532215.NS",
"532218.NS",
"532221.NS",
"532240.NS",
"532256.NS",
"532259.NS",
"532268.NS",
"532281.NS",
"532285.NS",
"532296.NS",
"532300.NS",
"532309.NS",
"532313.NS",
"532321.NS",
"532331.NS",
"532343.NS",
"532349.NS",
"532356.NS",
"532365.NS",
"532366.NS",
"532369.NS",
"532370.NS",
"532371.NS",
"532374.NS",
"532375.NS",
"532382.NS",
"532388.NS",
"532390.NS",
"532395.NS",
"517146.NS",
"532400.NS",
"532406.NS",
"532407.NS",
"532424.NS",
"532430.NS",
"532432.NS",
"532439.NS",
"532440.NS",
"532443.NS",
"890157.NS",
"532457.NS",
"532461.NS",
"532466.NS",
"532468.NS",
"532477.NS",
"532478.NS",
"532482.NS",
"532483.NS",
"532485.NS",
"532486.NS",
"532488.NS",
"532493.NS",
"532497.NS",
"532500.NS",
"532504.NS",
"532505.NS",
"JSL.NS",
"SUPRAJIT.NS",
"IGL.NS",
"TVTODAY.NS",
"PETRONET.NS",
"BIOCON.NS",
"PTC.NS",
"MAHABANK.NS",
"RKFORGE.NS",
"DATAMATICS.NS",
"STAR.NS",
"ULTRACEMCO.NS",
"UNOMINDA.NS",
"TCS.NS",
"COFORGE.NS",
"CENTURYPLY.NS",
"532553.NS",
"532555.NS",
"532605.NS",
"532612.NS",
"532616.NS",
"532624.NS",
"532626.NS",
"532627.NS",
"532630.NS",
"532633.NS",
"532636.NS",
"532638.NS",
"532642.NS",
"532644.NS",
"532648.NS",
"532650.NS",
"532652.NS",
"IDFC.NS",
"532661.NS",
"532663.NS",
"532667.NS",
"532668.NS",
"532670.NS",
"532683.NS",
"532684.NS",
"532686.NS",
"532689.NS",
"532698.NS",
"532699.NS",
"532702.NS",
"532705.NS",
"532714.NS",
"532717.NS",
"532722.NS",
"532725.NS",
"532726.NS",
"532729.NS",
"532732.NS",
"532733.NS",
"532734.NS",
"532735.NS",
"532742.NS",
"532748.NS",
"532749.NS",
"532754.NS",
"532755.NS",
"532756.NS",
"532757.NS",
"532762.NS",
"532768.NS",
"532772.NS",
"532775.NS",
"532777.NS",
"532779.NS",
"532783.NS",
"532784.NS",
"532790.NS",
"532798.NS",
"532799.NS",
"532800.NS",
"532804.NS",
"532805.NS",
"532808.NS",
"532809.NS",
"532810.NS",
"532811.NS",
"532814.NS",
"532815.NS",
"532822.NS",
"532827.NS",
"532830.NS",
"532834.NS",
"532835.NS",
"532842.NS",
"FORTIS.NS",
"532848.NS",
"MICEL.NS",
"532851.NS",
"TIMETECHNO.NS",
"532859.NS",
"NELCAST.NS",
"532867.NS",
"DLF.NS",
"SUNPHARMA.NS",
"532875.NS",
"532880.NS",
"532884.NS",
"532885.NS",
"532891.NS",
"532892.NS",
"532898.NS",
"532899.NS",
"532900.NS",
"532915.NS",
"532921.NS",
"532922.NS",
"532923.NS",
"532924.NS",
"532926.NS",
"532927.NS",
"532928.NS",
"532929.NS",
"532939.NS",
"532940.NS",
"532942.NS",
"532945.NS",
"532947.NS",
"532953.NS",
"532955.NS",
"532960.NS",
"532966.NS",
"532967.NS",
"532974.NS",
"532976.NS",
"132977.NS",
"532978.NS",
"532983.NS",
"LANDMARK.NS",
"533023.NS",
"533033.NS",
"533080.NS",
"533088.NS",
"533095.NS",
"533096.NS",
"533098.NS",
"533104.NS",
"533106.NS",
"533121.NS",
"533122.NS",
"533137.NS",
"533138.NS",
"533148.NS",
"533150.NS",
"533155.NS",
"533156.NS",
"533158.NS",
"533160.NS",
"533169.NS",
"533179.NS",
"533206.NS",
"533229.NS",
"533248.NS",
"533262.NS",
"533263.NS",
"533267.NS",
"533269.NS",
"533271.NS",
"533272.NS",
"533273.NS",
"533274.NS",
"533278.NS",
"533282.NS",
"533285.NS",
"533286.NS",
"533293.NS",
"533295.NS",
"533302.NS",
"533303.NS",
"533306.NS",
"533320.NS",
"533326.NS",
"533333.NS",
"533339.NS",
"533344.NS",
"533398.NS",
"533519.NS",
"533552.NS",
"533573.NS",
"533581.NS",
"533655.NS",
"533676.NS",
"533758.NS",
"533761.NS",
"534076.NS",
"534091.NS",
"534139.NS",
"534309.NS",
"534328.NS",
"534369.NS",
"534392.NS",
"534597.NS",
"534600.NS",
"534618.NS",
"534758.NS",
"534804.NS",
"534809.NS",
"534816.NS",
"534976.NS",
"535136.NS",
"535322.NS",
"535602.NS",
"535648.NS",
"535754.NS",
"535755.NS",
"537708.NS",
"538057.NS",
"538268.NS",
"538451.NS",
"538562.NS",
"538567.NS",
"538666.NS",
"538730.NS",
"538734.NS",
"538835.NS",
"538836.NS",
"538891.NS",
"538920.NS",
"538962.NS",
"538979.NS",
"539006.NS",
"539042.NS",
"539046.NS",
"539056.NS",
"539083.NS",
"539118.NS",
"539150.NS",
"539177.NS",
"539199.NS",
"539221.NS",
"539254.NS",
"539268.NS",
"539289.NS",
"539290.NS",
"539301.NS",
"539302.NS",
"539309.NS",
"539332.NS",
"539336.NS",
"539404.NS",
"539437.NS",
"539448.NS",
"539450.NS",
"539469.NS",
"539516.NS",
"539523.NS",
"539524.NS",
"539533.NS",
"539542.NS",
"539551.NS",
"539607.NS",
"539636.NS",
"539658.NS",
"539678.NS",
"539682.NS",
"539686.NS",
"539725.NS",
"539785.NS",
"539787.NS",
"539799.NS",
"539807.NS",
"539837.NS",
"539871.NS",
"539872.NS",
"539876.NS",
"539883.NS",
"539889.NS",
"539921.NS",
"539956.NS",
"539957.NS",
"539978.NS",
"539992.NS",
"539997.NS",
"540025.NS",
"540047.NS",
"540065.NS",
"540073.NS",
"540115.NS",
"540125.NS",
"540133.NS",
"540136.NS",
"540145.NS",
"540153.NS",
"540173.NS",
"540180.NS",
"540203.NS",
"540205.NS",
"540212.NS",
"540222.NS",
"540293.NS",
"540376.NS",
"540425.NS",
"540530.NS",
"540544.NS",
"540575.NS",
"540595.NS",
"540596.NS",
"540602.NS",
"540611.NS",
"540642.NS",
"540669.NS",
"540673.NS",
"540678.NS",
"540680.NS",
"540691.NS",
"540699.NS",
"540701.NS",
"540704.NS",
"540710.NS",
"540716.NS",
"540717.NS",
"540719.NS",
"540724.NS",
"540725.NS",
"540743.NS",
"540749.NS",
"540750.NS",
"540755.NS",
"540762.NS",
"540767.NS",
"540768.NS",
"540769.NS",
"540774.NS",
"540776.NS",
"540777.NS",
"540795.NS",
"540797.NS",
"540879.NS",
"540900.NS",
"540902.NS",
"540935.NS",
"532814.NS",
"540975.NS",
"540980.NS",
"541143.NS",
"541153.NS",
"541154.NS",
"541163.NS",
"541167.NS",
"541179.NS",
"541195.NS",
"541233.NS",
"541269.NS",
"541301.NS",
"540133.NS",
"541336.NS",
"541403.NS",
"541450.NS",
"SOLARA.NS",
"RITES.NS",
"FINEORG.NS",
"541578.NS",
"541700.NS",
"541729.NS",
"541770.NS",
"541809.NS",
"541956.NS",
"541967.NS",
"541974.NS",
"541988.NS",
"542011.NS",
"542066.NS",
"542131.NS",
"542141.NS",
"542216.NS",
"542323.NS",
"542333.NS",
"542399.NS",
"ANUP.NS",
"542484.NS",
"542597.NS",
"542649.NS",
"542650.NS",
"542651.NS",
"542652.NS",
"542665.NS",
"542669.NS",
"542726.NS",
"542727.NS",
"542752.NS",
"542759.NS",
"542760.NS",
"542772.NS",
"542773.NS",
"542774.NS",
"542812.NS",
"542830.NS",
"542857.NS",
"542867.NS",
"542904.NS",
"542905.NS",
"542907.NS",
"542919.NS",
"542920.NS",
"543064.NS",
"543066.NS",
"543187.NS",
"543212.NS",
"543213.NS",
"543214.NS",
"543220.NS",
"543227.NS",
"543228.NS",
"543230.NS",
"543232.NS",
"543235.NS",
"543237.NS",
"543238.NS",
"543240.NS",
"543242.NS",
"543243.NS",
"543245.NS",
"543248.NS",
"543249.NS",
"543252.NS",
"543253.NS",
"543254.NS",
"543258.NS",
"543259.NS",
"543260.NS",
"543263.NS",
"543265.NS",
"543266.NS",
"543270.NS",
"543271.NS",
"543272.NS",
"543273.NS",
"543275.NS",
"543276.NS",
"543277.NS",
"543278.NS",
"543279.NS",
"543280.NS",
"543283.NS",
"543287.NS",
"543288.NS",
"543291.NS",
"543297.NS",
"543299.NS",
"543300.NS",
"543306.NS",
"543308.NS",
"543311.NS",
"543317.NS",
"543318.NS",
"543320.NS",
"543321.NS",
"543322.NS",
"543325.NS",
"543328.NS",
"543329.NS",
"543330.NS",
"543331.NS",
"543332.NS",
"543333.NS",
"543334.NS",
"543335.NS",
"543336.NS",
"543349.NS",
"543350.NS",
"543358.NS",
"543367.NS",
"543374.NS",
"543384.NS",
"543386.NS",
"543389.NS",
"543390.NS",
"543396.NS",
"543397.NS",
"543398.NS",
"543399.NS",
"543401.NS",
"543411.NS",
"543412.NS",
"543413.NS",
"543415.NS",
"543417.NS",
"543419.NS",
"543426.NS",
"543427.NS",
"543428.NS",
"543434.NS",
"543441.NS",
"543449.NS",
"543458.NS",
"543463.NS",
"543481.NS",
"543482.NS",
"543489.NS",
"543490.NS",
"543498.NS",
"543514.NS",
"543517.NS",
"543523.NS",
"543524.NS",
"543526.NS",
"543527.NS",
"543528.NS",
"543529.NS",
"543530.NS",
"543532.NS",
"543533.NS",
"543534.NS",
"543542.NS",
"543547.NS",
"543573.NS",
"543590.NS",
"543591.NS",
"543596.NS",
"543597.NS",
"543600.NS",
"543619.NS",
"543620.NS",
"543626.NS",
"543635.NS",
"543650.NS",
"543652.NS",
"543653.NS",
"543654.NS",
"543657.NS",
"543663.NS",
"543664.NS",
"543667.NS",
"543669.NS",
"540133.NS",
"543686.NS",
"543689.NS",
"543711.NS",
"543712.NS",
"543714.NS",
"543720.NS",
"543748.NS",
"543766.NS",
"543768.NS",
"543775.NS",
"543812.NS",
"543896.NS",
"543904.NS",
"543920.NS",
"543923.NS",
"543928.NS",
"543929.NS",
"543932.NS",
"543933.NS",
"543936.NS",
"543940.NS",
"543942.NS",
"543945.NS",
"543950.NS",
"543952.NS",
"543953.NS",
"REDTAPE.NS",
"543959.NS",
"543960.NS",
"543965.NS",
"543971.NS",
"543972.NS",
"543974.NS",
"543977.NS",
"543980.NS",
"543981.NS",
"543983.NS",
"543984.NS",
"543985.NS",
"543988.NS",
"543989.NS",
"543990.NS",
"543992.NS",
"543994.NS",
"543995.NS",
"543996.NS",
"544004.NS",
"544008.NS",
"544009.NS",
"544012.NS",
"544014.NS",
"544020.NS",
"544021.NS",
"544022.NS",
"544026.NS",
"544027.NS",
"544028.NS",
"544029.NS",
"544030.NS",
"544037.NS",
"544042.NS",
"544044.NS",
"544045.NS",
"544046.NS",
"544053.NS",
"544054.NS",
"544055.NS",
"544057.NS",
"544058.NS",
"544061.NS",
"544066.NS",
"544067.NS",
"544081.NS",
"544088.NS",
"544095.NS",
"544107.NS",
"544111.NS",
"544118.NS",
"544119.NS",
"544120.NS",
"544122.NS",
"544129.NS",
"544131.NS",
"544133.NS",
"544134.NS",
"544140.NS",
"544142.NS",
"544150.NS",
"544158.NS",
"544161.NS",
"544162.NS",
"AZZ2.NS",
"532134.NS",
"ICICIPRULI.NS",
"ICICIPRULI.NS",
"TATAMOTORS.NS",
"JISLJALEQS.NS",
"KARURVYSYA.NS",
"VEEDOL.NS",
"AMRUTANJAN.NS",
"XPROINDIA.NS",
"BHARATRAS.NS",
"SAKSOFT.NS",
"ANDHRSUGAR.NS",
"IMPAL.NS",
"SUNDARMFIN.NS",
"WHEELS.NS",
"MAITHANALL.NS",
"ORISSAMINE.NS",
"NIFTYBEES.NS",
"JUNIORBEES.NS",
"BANKBEES.NS",
"PSUBANK.NS",
"PSUBNKBEES.NS",
"590134.NS",
"500112.NS",
"500306.NS",
"533263.NS",
"890157.NS",
"539289.NS",
"890190.NS",
"538562.NS",
"SOLARA.NS",
"532784.NS"
]

# ----------------------------------
# UTILITIES
# ----------------------------------

def compute_slope(close_series):
    y = close_series.values
    x = np.arange(len(y))
    if len(y) < 5:
        return np.nan
    try:
        return np.polyfit(x, y, 1)[0]
    except:
        return np.nan

@st.cache_data(show_spinner=False)
def fetch_prices(tickers, period="6mo", interval="1d"):
    try:
        return yf.download(tickers, period=period, interval=interval, progress=False)
    except Exception:
        return None

# ----------------------------------
# PROCESS BATCH
# ----------------------------------

def process_batch(tickers):
    data = fetch_prices(tickers)
    if data is None or "Close" not in data:
        return pd.DataFrame()

    close_df = data["Close"]
    rows = []

    for tk in close_df.columns:
        s = close_df[tk].dropna()
        if len(s) < 10:
            continue

        slope = compute_slope(s[-60:])
        ret_1m = (s.iloc[-1] / s.iloc[-21] - 1) * 100 if len(s) >= 22 else np.nan
        ret_3m = (s.iloc[-1] / s.iloc[-63] - 1) * 100 if len(s) >= 64 else np.nan

        rows.append({
            "Ticker": tk,
            "Close": s.iloc[-1],
            "Slope": slope,
            "Ret1M": ret_1m,
            "Ret3M": ret_3m,
        })

    df = pd.DataFrame(rows)
    if df.empty:
        return df

    if df["Slope"].notna().any():
        mn, mx = df["Slope"].min(), df["Slope"].max()
        df["SlopeNorm"] = (df["Slope"] - mn) / (mx - mn + 1e-9)
    else:
        df["SlopeNorm"] = 0

    df["FinalScore"] = (
        0.7 * df["SlopeNorm"].fillna(0) +
        0.15 * df["Ret1M"].fillna(0) +
        0.15 * df["Ret3M"].fillna(0)
    )

    return df.sort_values("FinalScore", ascending=False).reset_index(drop=True)

# ----------------------------------
# STREAMLIT UI
# ----------------------------------

st.title("Momentum Scanner India — Clean Version (No Fundamentals)")
st.write("Fast TA-only ranking for NSE large + mid + small caps")

batch_size = st.sidebar.slider("Batch Size", 20, 200, 80, step=20)
if st.sidebar.button("Clear Cache"):
    st.cache_data.clear()
    st.experimental_rerun()

final_df = []
for i in range(0, len(TICKERS), batch_size):
    batch = TICKERS[i: i + batch_size]
    st.write(f"Processing {len(batch)} tickers...")
    out = process_batch(batch)
    if not out.empty:
        final_df.append(out)

if final_df:
    final = (
        pd.concat(final_df)
        .sort_values("FinalScore", ascending=False)
        .reset_index(drop=True)
    )

    final = final[final["Ret1M"] < 20]

    st.subheader("Top NSE Momentum Picks (<20% 1M return)")
    st.dataframe(final.head(250))

else:
    st.error("No results. Check tickers or yfinance status.")
